name: Issue Automation

on:
  issues:
    types: [opened, edited, labeled, assigned]

jobs:
  issue-comment:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Comment on new issue
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸ› **ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!**
              
              ì•ˆë…•í•˜ì„¸ìš” @${{ github.event.issue.user.login }}ë‹˜! ì´ìŠˆë¥¼ ìƒì„±í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.
              
              ## ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤
              1. ğŸ·ï¸ ì ì ˆí•œ ë¼ë²¨ì´ ìë™ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤
              2. ğŸ‘¥ ë‹´ë‹¹ìê°€ ìë™ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤
              3. ğŸ” ì´ìŠˆê°€ ê²€í† ë˜ê³  ìš°ì„ ìˆœìœ„ê°€ ì„¤ì •ë©ë‹ˆë‹¤
              
              ## ì´ìŠˆ ìƒíƒœ
              - **ìƒì„±ë¨**: ì´ìŠˆê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤
              - **ì§„í–‰ì¤‘**: ë‹´ë‹¹ìê°€ ì‘ì—…ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤
              - **ì™„ë£Œ**: ì´ìŠˆê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤
              
              ## ë„ì›€ì´ í•„ìš”í•˜ì‹ ê°€ìš”?
              - ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”
              - ê¸‰í•œ ì´ìŠˆì¸ ê²½ìš° \`critical\` ë¼ë²¨ì„ ì¶”ê°€í•´ì£¼ì„¸ìš”
              
              ë¹ ë¥¸ ì‹œì¼ ë‚´ì— í™•ì¸í•˜ì—¬ ì²˜ë¦¬í•˜ê² ìŠµë‹ˆë‹¤! ğŸš€`
            })

  issue-assign:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Auto assign issue
        uses: actions/github-script@v6
        with:
          script: |
            const assignees = [];
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body?.toLowerCase() || '';
            const labels = context.payload.issue.labels.map(label => label.name.toLowerCase());
            
            // ì´ìŠˆ ë‚´ìš©ì— ë”°ë¥¸ ìë™ í• ë‹¹ ë¡œì§
            
            // ë°±ì—”ë“œ ê´€ë ¨ ì´ìŠˆ
            if (title.includes('backend') || body.includes('backend') || 
                title.includes('api') || body.includes('api') ||
                title.includes('server') || body.includes('server')) {
              // ë°±ì—”ë“œ ê°œë°œìë“¤ì„ ì—¬ê¸°ì— ì¶”ê°€ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½)
              // assignees.push('backend-lead', 'backend-developer');
            }
            
            // í”„ë¡ íŠ¸ì—”ë“œ ê´€ë ¨ ì´ìŠˆ
            if (title.includes('frontend') || body.includes('frontend') ||
                title.includes('ui') || body.includes('ui') ||
                title.includes('ux') || body.includes('ux')) {
              // í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë“¤ì„ ì—¬ê¸°ì— ì¶”ê°€ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½)
              // assignees.push('frontend-lead', 'frontend-developer');
            }
            
            // ë¬¸ì„œ ê´€ë ¨ ì´ìŠˆ
            if (title.includes('docs') || body.includes('docs') ||
                title.includes('documentation') || body.includes('documentation') ||
                title.includes('readme') || body.includes('readme')) {
              // ë¬¸ì„œ ë‹´ë‹¹ìë¥¼ ì—¬ê¸°ì— ì¶”ê°€ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½)
              // assignees.push('docs-maintainer');
            }
            
            // ë²„ê·¸ ê´€ë ¨ ì´ìŠˆ
            if (title.includes('bug') || body.includes('bug') ||
                title.includes('error') || body.includes('error') ||
                title.includes('fix') || body.includes('fix')) {
              // QA íŒ€ì´ë‚˜ ë²„ê·¸ ë‹´ë‹¹ìë¥¼ ì—¬ê¸°ì— ì¶”ê°€ (ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½)
              // assignees.push('qa-lead', 'bug-triager');
            }
            
            // ì´ìŠˆ ì‘ì„±ìë¥¼ ê¸°ë³¸ assigneeë¡œ ì¶”ê°€
            assignees.push(context.payload.issue.user.login);
            
            // Assignee í• ë‹¹
            if (assignees.length > 0) {
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                assignees: [...new Set(assignees)] // ì¤‘ë³µ ì œê±°
              });
            }

  issue-labeler:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Auto label issue
        uses: actions/github-script@v6
        with:
          script: |
            const labels = [];
            const title = context.payload.issue.title.toLowerCase();
            const body = context.payload.issue.body?.toLowerCase() || '';
            
            // ì´ìŠˆ íƒ€ì…ì— ë”°ë¥¸ ë¼ë²¨ë§
            if (title.includes('bug') || body.includes('bug') ||
                title.includes('error') || body.includes('error') ||
                title.includes('broken') || body.includes('broken')) {
              labels.push('bug');
            }
            
            if (title.includes('feature') || body.includes('feature') ||
                title.includes('enhancement') || body.includes('enhancement') ||
                title.includes('improve') || body.includes('improve')) {
              labels.push('enhancement');
            }
            
            if (title.includes('question') || body.includes('question') ||
                title.includes('help') || body.includes('help') ||
                title.includes('how to') || body.includes('how to')) {
              labels.push('question');
            }
            
            if (title.includes('docs') || body.includes('docs') ||
                title.includes('documentation') || body.includes('documentation') ||
                title.includes('readme') || body.includes('readme')) {
              labels.push('documentation');
            }
            
            // ì»´í¬ë„ŒíŠ¸ë³„ ë¼ë²¨ë§
            if (title.includes('backend') || body.includes('backend') ||
                title.includes('api') || body.includes('api') ||
                title.includes('server') || body.includes('server')) {
              labels.push('backend');
            }
            
            if (title.includes('frontend') || body.includes('frontend') ||
                title.includes('ui') || body.includes('ui') ||
                title.includes('ux') || body.includes('ux')) {
              labels.push('frontend');
            }
            
            // ìš°ì„ ìˆœìœ„ ë¼ë²¨ë§
            if (title.includes('critical') || body.includes('critical') ||
                title.includes('urgent') || body.includes('urgent') ||
                title.includes('emergency') || body.includes('emergency')) {
              labels.push('priority/critical');
            } else if (title.includes('high priority') || body.includes('high priority') ||
                       title.includes('important') || body.includes('important')) {
              labels.push('priority/high');
            } else if (title.includes('low priority') || body.includes('low priority') ||
                       title.includes('nice to have') || body.includes('nice to have')) {
              labels.push('priority/low');
            } else {
              labels.push('priority/medium');
            }
            
            // ì–¸ì–´ë³„ ë¼ë²¨ë§
            if (title.includes('python') || body.includes('python') ||
                title.includes('.py') || body.includes('.py')) {
              labels.push('python');
            }
            
            if (title.includes('javascript') || body.includes('javascript') ||
                title.includes('js') || body.includes('js') ||
                title.includes('.js') || body.includes('.js')) {
              labels.push('javascript');
            }
            
            // ê¸°ë³¸ ë¼ë²¨ ì¶”ê°€
            labels.push('needs-triage');
            
            // ë¼ë²¨ ì ìš©
            if (labels.length > 0) {
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.issue.number,
                labels: [...new Set(labels)] // ì¤‘ë³µ ì œê±°
              });
            }

  issue-priority-comment:
    runs-on: ubuntu-latest
    if: github.event.action == 'labeled' && contains(github.event.label.name, 'priority/critical')
    steps:
      - name: Comment on critical issue
        uses: actions/github-script@v6
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: `ğŸš¨ **ê¸´ê¸‰ ì´ìŠˆë¡œ ë¶„ë¥˜ë˜ì—ˆìŠµë‹ˆë‹¤!**
              
              ì´ ì´ìŠˆëŠ” \`critical\` ìš°ì„ ìˆœìœ„ë¡œ ë¶„ë¥˜ë˜ì–´ ì¦‰ì‹œ ì²˜ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.
              
              ## ì²˜ë¦¬ ì ˆì°¨
              1. ë‹´ë‹¹ìê°€ ì¦‰ì‹œ í™•ì¸í•©ë‹ˆë‹¤
              2. 24ì‹œê°„ ë‚´ ì´ˆê¸° ë¶„ì„ì„ ì™„ë£Œí•©ë‹ˆë‹¤
              3. í•´ê²° ê³„íšì„ ìˆ˜ë¦½í•˜ê³  ì¼ì •ì„ ê³µìœ í•©ë‹ˆë‹¤
              
              ## ì•Œë¦¼
              ê´€ë ¨ íŒ€ì›ë“¤ì—ê²Œ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.
              
              ì¶”ê°€ ì •ë³´ê°€ í•„ìš”í•˜ì‹œë©´ ì–¸ì œë“  ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”! âš¡`
            })

  issue-stale-check:
    runs-on: ubuntu-latest
    if: github.event.action == 'opened'
    steps:
      - name: Add to project board
        uses: actions/github-script@v6
        with:
          script: |
            // 30ì¼ í›„ stale ì²´í¬ë¥¼ ìœ„í•œ reminder ì„¤ì •
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” scheduled workflowë¥¼ ë³„ë„ë¡œ ë§Œë“¤ì–´ ì²˜ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤
            console.log('ì´ìŠˆê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. 30ì¼ í›„ stale ì²´í¬ ëŒ€ìƒì´ ë©ë‹ˆë‹¤.'); 